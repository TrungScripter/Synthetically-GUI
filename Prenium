-- AUTO TRADE ACCEPT + INSTANT BAT EQUIP
-- For Xeno Executor
-- Auto-accepts trades and instantly equips bat when trading

local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local backpack = player:WaitForChild("Backpack")

-- Configuration
local ENABLED = true
local AUTO_ACCEPT_TRADE = true
local INSTANT_BAT_EQUIP = true
local BAT_NAMES = {"Bat", "bat", "Baseball Bat", "Bat Weapon"}  -- Multiple possible bat names
local CHECK_INTERVAL = 0.3  -- Faster checking

-- Trade tracking
local currentTrade = nil
local isTrading = false
local tradePartners = {}
local lastTradeDetection = 0

-- GUI for status
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "AutoTradeGUI"
screenGui.Parent = game:GetService("CoreGui")

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 300, 0, 150)
mainFrame.Position = UDim2.new(0.5, -150, 0, 10)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
mainFrame.BackgroundTransparency = 0.1
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 8)
UICorner.Parent = mainFrame

-- Title
local title = Instance.new("TextLabel")
title.Text = "⚡ INSTANT TRADE SCRIPT"
title.Size = UDim2.new(1, 0, 0, 40)
title.Position = UDim2.new(0, 0, 0, 0)
title.BackgroundColor3 = Color3.fromRGB(45, 45, 60)
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Font = Enum.Font.GothamBold
title.TextSize = 16
title.Parent = mainFrame

-- Status
local statusLabel = Instance.new("TextLabel")
statusLabel.Text = "STATUS: ACTIVE"
statusLabel.Size = UDim2.new(1, 0, 0, 30)
statusLabel.Position = UDim2.new(0, 0, 0, 40)
statusLabel.BackgroundTransparency = 1
statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
statusLabel.Font = Enum.Font.GothamSemibold
statusLabel.TextSize = 14
statusLabel.Parent = mainFrame

-- Trade Info
local tradeInfoLabel = Instance.new("TextLabel")
tradeInfoLabel.Text = "Trade: Waiting..."
tradeInfoLabel.Size = UDim2.new(1, 0, 0, 30)
tradeInfoLabel.Position = UDim2.new(0, 0, 0, 70)
tradeInfoLabel.BackgroundTransparency = 1
tradeInfoLabel.TextColor3 = Color3.fromRGB(200, 200, 255)
tradeInfoLabel.Font = Enum.Font.Gotham
tradeInfoLabel.TextSize = 12
tradeInfoLabel.Parent = mainFrame

-- Bat Status
local batStatusLabel = Instance.new("TextLabel")
batStatusLabel.Text = "Bat: Ready"
batStatusLabel.Size = UDim2.new(1, 0, 0, 30)
batStatusLabel.Position = UDim2.new(0, 0, 0, 100)
batStatusLabel.BackgroundTransparency = 1
batStatusLabel.TextColor3 = Color3.fromRGB(200, 200, 255)
batStatusLabel.Font = Enum.Font.Gotham
batStatusLabel.TextSize = 12
batStatusLabel.Parent = mainFrame

-- Cache bat for instant access
local cachedBat = nil
local lastBatCheck = 0
local BAT_CACHE_DURATION = 5  -- Refresh cache every 5 seconds

-- Functions
local function findBat()
    -- Check cache first
    if cachedBat and cachedBat:IsDescendantOf(game) then
        return cachedBat
    end
    
    -- Refresh cache periodically
    if tick() - lastBatCheck < BAT_CACHE_DURATION then
        return cachedBat
    end
    
    lastBatCheck = tick()
    cachedBat = nil
    
    -- Search in backpack
    if backpack then
        for _, item in pairs(backpack:GetChildren()) do
            if item:IsA("Tool") then
                for _, batName in ipairs(BAT_NAMES) do
                    if string.find(string.lower(item.Name), string.lower(batName)) then
                        cachedBat = item
                        return cachedBat
                    end
                end
            end
        end
    end
    
    -- Search in character
    if character then
        for _, item in pairs(character:GetChildren()) do
            if item:IsA("Tool") then
                for _, batName in ipairs(BAT_NAMES) do
                    if string.find(string.lower(item.Name), string.lower(batName)) then
                        cachedBat = item
                        return cachedBat
                    end
                end
            end
        end
    end
    
    return nil
end

-- INSTANT bat equip (no delays, immediate)
local function instantEquipBat()
    if not INSTANT_BAT_EQUIP then return false end
    
    local bat = findBat()
    if not bat then
        batStatusLabel.Text = "Bat: Not Found ✗"
        batStatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
        return false
    end
    
    if not character or not character:FindFirstChild("Humanoid") then
        batStatusLabel.Text = "Bat: No Character ✗"
        batStatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
        return false
    end
    
    local humanoid = character.Humanoid
    
    -- INSTANT EQUIP - Direct method with no delays
    local success = pcall(function()
        -- Use immediate equip without unequip first (faster)
        humanoid:EquipTool(bat)
        
        -- Alternative method if first fails
        if not character:FindFirstChild(bat.Name) then
            -- Force equip by removing and re-adding
            local batClone = bat:Clone()
            batClone.Parent = backpack
            humanoid:EquipTool(batClone)
        end
    end)
    
    if success then
        batStatusLabel.Text = "Bat: INSTANT ✓"
        batStatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        return true
    else
        -- Fallback: try standard method
        pcall(function()
            humanoid:UnequipTools()
            humanoid:EquipTool(bat)
        end)
        
        batStatusLabel.Text = "Bat: Equipped ✓"
        batStatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        return true
    end
end

-- ULTRA FAST trade detection
local function detectTradeInstantly()
    -- Method 1: Direct GUI scanning
    local guiNames = {
        "Trade", "Trading", "TradeGUI", "TradeMenu",
        "TradeFrame", "TradeWindow", "TradingGUI",
        "TradeRequest", "TradeAccept"
    }
    
    -- Check CoreGui first
    local coreGui = game:GetService("CoreGui")
    for _, name in pairs(guiNames) do
        local gui = coreGui:FindFirstChild(name)
        if gui then
            return true, gui
        end
    end
    
    -- Check PlayerGui
    local playerGui = player:FindFirstChild("PlayerGui")
    if playerGui then
        for _, name in pairs(guiNames) do
            local gui = playerGui:FindFirstChild(name)
            if gui then
                return true, gui
            end
        end
    end
    
    -- Method 2: Scan for trade text
    local function scanForTradeText(parent)
        for _, gui in pairs(parent:GetDescendants()) do
            if gui:IsA("TextButton") or gui:IsA("TextLabel") then
                local text = string.lower(gui.Text or "")
                if string.find(text, "accept") or 
                   string.find(text, "trade") or 
                   string.find(text, "confirm") then
                    return true, gui
                end
            end
        end
        return false, nil
    end
    
    local found, element = scanForTradeText(coreGui)
    if found then return true, element end
    
    if playerGui then
        found, element = scanForTradeText(playerGui)
        if found then return true, element end
    end
    
    return false, nil
end

-- INSTANT trade acceptance
local function instantAcceptTrade()
    if not AUTO_ACCEPT_TRADE then return false end
    
    local tradeFound, tradeElement = detectTradeInstantly()
    if not tradeFound then return false end
    
    -- Try to find and click accept button
    local function clickAcceptButtons(parent)
        for _, gui in pairs(parent:GetDescendants()) do
            if gui:IsA("TextButton") or gui:IsA("ImageButton") then
                local text = string.lower(gui.Text or "")
                local name = string.lower(gui.Name or "")
                
                if string.find(text, "accept") or 
                   string.find(text, "confirm") or
                   string.find(text, "trade") then
                    
                    -- INSTANT CLICK - multiple methods
                    pcall(function() gui:FireEvent("MouseButton1Click") end)
                    pcall(function() gui:FireEvent("Activated") end)
                    pcall(function() gui:FireEvent("MouseButton1Down") end)
                    pcall(function() gui:FireEvent("MouseButton1Up") end)
                    
                    tradeInfoLabel.Text = "Trade: ACCEPTED ✓"
                    tradeInfoLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
                    return true
                end
            end
        end
        return false
    end
    
    local clicked = clickAcceptButtons(game:GetService("CoreGui"))
    if not clicked and player:FindFirstChild("PlayerGui") then
        clicked = clickAcceptButtons(player.PlayerGui)
    end
    
    return clicked
end

-- Pre-cache bat on startup
task.spawn(function()
    task.wait(1)
    local bat = findBat()
    if bat then
        warn("[BAT CACHED] " .. bat.Name .. " ready for instant equip")
        batStatusLabel.Text = "Bat: Cached ✓"
        batStatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
    else
        warn("[BAT WARNING] No bat found!")
        batStatusLabel.Text = "Bat: Not Found ✗"
        batStatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
    end
end)

-- INSTANT trade response loop
task.spawn(function()
    local lastTradeState = false
    local batEquippedAtTradeStart = false
    
    while true do
        if ENABLED then
            -- Update bat cache periodically
            if tick() - lastBatCheck > BAT_CACHE_DURATION then
                findBat()
            end
            
            -- INSTANT trade detection
            local tradeFound = detectTradeInstantly()
            
            if tradeFound then
                if not lastTradeState then
                    -- Trade just started
                    lastTradeState = true
                    tradeInfoLabel.Text = "Trade: DETECTED!"
                    tradeInfoLabel.TextColor3 = Color3.fromRGB(255, 200, 100)
                    
                    -- INSTANT BAT EQUIP - IMMEDIATELY
                    if INSTANT_BAT_EQUIP then
                        instantEquipBat()
                    end
                    
                    -- INSTANT TRADE ACCEPT - IMMEDIATELY
                    if AUTO_ACCEPT_TRADE then
                        instantAcceptTrade()
                    end
                    
                    warn("[TRADE START] Detected trade - Instant actions triggered")
                end
                
                -- Keep trying to accept during trade
                if AUTO_ACCEPT_TRADE then
                    instantAcceptTrade()
                end
                
                -- Keep bat equipped during trade
                if INSTANT_BAT_EQUIP then
                    -- Check if bat is still equipped
                    local batEquipped = false
                    if character then
                        local bat = findBat()
                        if bat then
                            batEquipped = character:FindFirstChild(bat.Name) ~= nil
                        end
                    end
                    
                    if not batEquipped then
                        instantEquipBat()
                    end
                end
            else
                if lastTradeState then
                    -- Trade just ended
                    lastTradeState = false
                    tradeInfoLabel.Text = "Trade: Ended"
                    task.wait(1)
                    tradeInfoLabel.Text = "Trade: Waiting..."
                    tradeInfoLabel.TextColor3 = Color3.fromRGB(200, 200, 255)
                end
            end
        end
        
        task.wait(CHECK_INTERVAL)
    end
end)

-- Hook into game events for instant detection
task.spawn(function()
    task.wait(2)
    
    -- Listen for chat trade requests
    if game:GetService("TextChatService") then
        local success, chatService = pcall(function()
            return game:GetService("TextChatService"):WaitForChild("TextChannels"):WaitForChild("RBXSystem")
        end)
        
        if success and chatService then
            chatService.ChildAdded:Connect(function(message)
                if message:IsA("TextLabel") then
                    local text = string.lower(message.Text)
                    if string.find(text, "trade") or string.find(text, "wants to trade") then
                        warn("[CHAT TRADE] Detected in chat")
                        
                        -- INSTANT RESPONSE to chat trade
                        task.wait(0.5)  -- Small delay for GUI to appear
                        if INSTANT_BAT_EQUIP then
                            instantEquipBat()
                        end
                        if AUTO_ACCEPT_TRADE then
                            instantAcceptTrade()
                        end
                    end
                end
            end)
        end
    end
    
    -- Hook remote events for instant detection
    local function hookTradeRemotes()
        local remotes = {
            ReplicatedStorage,
            Workspace,
            game:GetService("ServerStorage"),
            game:GetService("ServerScriptService")
        }
        
        for _, parent in ipairs(remotes) do
            pcall(function()
                for _, item in pairs(parent:GetDescendants()) do
                    if item:IsA("RemoteEvent") or item:IsA("RemoteFunction") then
                        local name = string.lower(item.Name)
                        if string.find(name, "trade") then
                            warn("[HOOKED TRADE REMOTE] " .. item.Name)
                            
                            if item:IsA("RemoteEvent") then
                                local oldFire = item.FireServer
                                item.FireServer = function(self, ...)
                                    -- INSTANT response when trade event fires
                                    if INSTANT_BAT_EQUIP then
                                        instantEquipBat()
                                    end
                                    return oldFire(self, ...)
                                end
                            end
                        end
                    end
                end
            end)
        end
    end
    
    hookTradeRemotes()
end)

-- Keep bat equipped at all times (optional aggressive mode)
local KEEP_BAT_EQUIPPED_ALWAYS = false
if KEEP_BAT_EQUIPPED_ALWAYS then
    task.spawn(function()
        while true do
            if ENABLED then
                local bat = findBat()
                if bat and character and character:FindFirstChild("Humanoid") then
                    local humanoid = character.Humanoid
                    local currentTool = character:FindFirstChild(bat.Name)
                    if not currentTool then
                        humanoid:EquipTool(bat)
                    end
                end
            end
            task.wait(1)
        end
    end)
end

-- Keyboard shortcuts
UIS.InputBegan:Connect(function(input, gp)
    if gp then return end
    
    -- Toggle script
    if input.KeyCode == Enum.KeyCode.T then
        ENABLED = not ENABLED
        if ENABLED then
            statusLabel.Text = "STATUS: ACTIVE"
            statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
            warn("[AUTO-TRADE] Enabled")
        else
            statusLabel.Text = "STATUS: DISABLED"
            statusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
            warn("[AUTO-TRADE] Disabled")
        end
    end
    
    -- INSTANT bat equip (manual)
    if input.KeyCode == Enum.KeyCode.B then
        if instantEquipBat() then
            warn("[INSTANT] Bat equipped immediately")
        end
    end
    
    -- Force accept trade
    if input.KeyCode == Enum.KeyCode.A then
        if instantAcceptTrade() then
            warn("[INSTANT] Trade accepted immediately")
        end
    end
    
    -- Test mode: Simulate trade detection
    if input.KeyCode == Enum.KeyCode.Y then
        warn("[TEST] Simulating trade detection...")
        tradeInfoLabel.Text = "Trade: TEST MODE"
        tradeInfoLabel.TextColor3 = Color3.fromRGB(255, 255, 100)
        instantEquipBat()
        instantAcceptTrade()
    end
end)

-- Auto-update character reference
player.CharacterAdded:Connect(function(newChar)
    character = newChar
    task.wait(0.5)
    -- Clear cache when character changes
    cachedBat = nil
    lastBatCheck = 0
    findBat()  -- Re-cache bat
end)

-- Monitor backpack changes
backpack.ChildAdded:Connect(function(child)
    if child:IsA("Tool") then
        for _, batName in ipairs(BAT_NAMES) do
            if string.find(string.lower(child.Name), string.lower(batName)) then
                cachedBat = child
                batStatusLabel.Text = "Bat: Found ✓"
                batStatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
                warn("[BAT DETECTED] New bat found: " .. child.Name)
                break
            end
        end
    end
end)

warn("========================================")
warn("[INSTANT TRADE] Script loaded!")
warn("[CONTROLS] T = Toggle")
warn("[CONTROLS] B = Instant Bat Equip")
warn("[CONTROLS] A = Instant Trade Accept")
warn("[CONTROLS] Y = Test Mode")
warn("[FEATURES] INSTANT bat equip on trade")
warn("[FEATURES] INSTANT trade accept")
warn("[BAT NAMES] Looking for: " .. table.concat(BAT_NAMES, ", "))
warn("[SPEED] Check interval: " .. CHECK_INTERVAL .. "s")
warn("========================================")

-- Initial bat check with notification
task.wait(1)
local bat = findBat()
if bat then
    warn("[READY] Bat ready for instant equip: " .. bat.Name)
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "⚡ Instant Trade Ready",
        Text = "Bat cached: " .. bat.Name,
        Duration = 3,
    })
else
    warn("[WARNING] No bat found in inventory!")
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "⚠️ Bat Not Found",
        Text = "Add a bat to your inventory",
        Duration = 5,
    })
end
